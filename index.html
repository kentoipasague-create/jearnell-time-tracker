<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jearnell Ken Time Tracker</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
  header { background:#1e3a8a; color:white; padding:20px; text-align:center; }
  .container { max-width:900px; margin:20px auto; background:white; padding:20px; border-radius:10px; }
  input, select, button { padding:10px; margin:5px 0; border-radius:5px; border:1px solid #ccc; }
  button { background:#1e3a8a; color:white; border:none; cursor:pointer; }
  table { width:100%; border-collapse: collapse; margin-top:20px; }
  th, td { border:1px solid #ddd; padding:8px; text-align:left; }
  th { background:#f0f0f0; }
  .dashboard { display:flex; justify-content:space-around; margin-top:20px; }
  .dash-box { background:#e0e7ff; padding:15px; border-radius:8px; width:45%; text-align:center; }
  .dash-box h2 { margin:0 0 10px 0; font-size:18px; color:#1e3a8a; }
  .dash-box p { margin:0; font-size:16px; }
</style>
</head>
<body>
<header>
  <h1>Jearnell Ken Time Tracker</h1>
</header>
<div class="container">
  <h2>Add Task</h2>
  <input type="text" id="taskName" placeholder="Task Name">
  <select id="taskCategory">
    <option value="Work">Work</option>
    <option value="Study">Study</option>
    <option value="Exercise">Exercise</option>
    <option value="Other">Other</option>
  </select>
  <button onclick="startTask()">Start Task</button>

  <div class="dashboard">
    <div class="dash-box">
      <h2>Today's Time</h2>
      <p id="todayTime">00:00:00</p>
    </div>
    <div class="dash-box">
      <h2>This Week</h2>
      <p id="weekTime">00:00:00</p>
    </div>
  </div>

  <h2>Tasks</h2>
  <table>
    <thead>
      <tr><th>Task</th><th>Category</th><th>Start</th><th>End</th><th>Duration</th><th>Action</th></tr>
    </thead>
    <tbody id="tasksTable"></tbody>
  </table>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem('tasks') || '[]');

function saveTasks() {
  localStorage.setItem('tasks', JSON.stringify(tasks));
  renderTasks();
  updateDashboard();
}

function startTask() {
  const name = document.getElementById('taskName').value.trim();
  const category = document.getElementById('taskCategory').value;
  if(!name) return alert('Enter task name');
  tasks.push({name, category, start: new Date().toISOString(), end: null});
  document.getElementById('taskName').value = '';
  saveTasks();
}

function stopTask(index) {
  tasks[index].end = new Date().toISOString();
  saveTasks();
}

function deleteTask(index) {
  tasks.splice(index, 1);
  saveTasks();
}

// Format HH:MM:SS
function formatDuration(ms) {
  let totalSeconds = Math.floor(ms / 1000);
  let hrs = Math.floor(totalSeconds / 3600).toString().padStart(2,'0');
  let mins = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2,'0');
  let secs = (totalSeconds % 60).toString().padStart(2,'0');
  return `${hrs}:${mins}:${secs}`;
}

function getTaskDuration(task) {
  const endTime = task.end ? new Date(task.end) : new Date();
  return endTime - new Date(task.start);
}

function renderTasks() {
  const tbody = document.getElementById('tasksTable');
  tbody.innerHTML = '';
  tasks.forEach((t,i) => {
    const start = new Date(t.start).toLocaleString();
    const end = t.end ? new Date(t.end).toLocaleString() : '-';
    const duration = formatDuration(getTaskDuration(t));
    const actionBtns = t.end 
      ? `<button onclick="deleteTask(${i})">Delete</button>`
      : `<button onclick="stopTask(${i})">Stop</button> <button onclick="deleteTask(${i})">Delete</button>`;
    tbody.innerHTML += `<tr>
      <td>${t.name}</td>
      <td>${t.category}</td>
      <td>${start}</td>
      <td>${end}</td>
      <td>${duration}</td>
      <td>${actionBtns}</td>
    </tr>`;
  });
}

function updateDashboard() {
  const now = new Date();
  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const weekStart = new Date(now);
  weekStart.setDate(now.getDate() - now.getDay());

  let todayMs = 0;
  let weekMs = 0;

  tasks.forEach(t => {
    const duration = getTaskDuration(t);
    const start = new Date(t.start);
    if(start >= todayStart) todayMs += duration;
    if(start >= weekStart) weekMs += duration;
  });

  document.getElementById('todayTime').innerText = formatDuration(todayMs);
  document.getElementById('weekTime').innerText = formatDuration(weekMs);
}

function checkDailyReset() {
  const lastDate = localStorage.getItem('lastDate');
  const todayStr = new Date().toDateString();
  if(lastDate !== todayStr) {
    localStorage.setItem('lastDate', todayStr);
    updateDashboard();
  }
}

setInterval(()=>{
  renderTasks();
  updateDashboard();
  checkDailyReset();
}, 1000);

checkDailyReset();
renderTasks();
updateDashboard();
</script>
</body>
</html>
